// pentest-ai.js - Pentesting AI Assistant
class PentestAI {
    constructor() {
        this.conversation = [];
        this.isThinking = false;
        this.knowledgeBase = this.getKnowledgeBase();
    }

    getKnowledgeBase() {
        return {
            greetings: [
                "I detect a new connection. State your security inquiry.",
                "Pentesting AI online. How can I assist with your security assessment?",
                "Cybersecurity analysis ready. What vulnerabilities concern you?",
                "Security protocols engaged. What's your target?",
                "Threat assessment system active. Proceed with your query."
            ],
            pentesting: {
                "nmap": "Nmap is a network scanning tool. Use 'nmap -sS target.com' for SYN scan, 'nmap -A' for aggressive scan, or 'nmap -p 1-1000' for specific ports.",
                "metasploit": "Metasploit is an exploitation framework. Start with 'msfconsole', search exploits with 'search type:exploit', use 'use exploit/path' and 'set RHOSTS target'.",
                "burp suite": "Burp Suite is for web app testing. Configure browser proxy to 127.0.0.1:8080, intercept requests, and use Scanner for automated testing.",
                "sql injection": "Test for SQLi with ' OR '1'='1 in login fields. Use tools like SQLmap: 'sqlmap -u target.com/page?param=value --dbs'",
                "xss": "Test for XSS with <script>alert('XSS')</script> or <img src=x onerror=alert(1)> in input fields and URL parameters.",
                "wireless": "For wireless testing, use aircrack-ng suite: 'airmon-ng start wlan0', 'airodump-ng wlan0mon', capture handshake with 'aireplay-ng'",
                "social engineering": "Phishing tests should simulate realistic scenarios. Use tools like Gophish or SEToolkit. Always get proper authorization."
            },
            responses: {
                "hello": "greetings",
                "hi": "greetings", 
                "hey": "greetings",
                "help": "Help activated. I can assist with: nmap, metasploit, burp suite, sql injection, xss, wireless testing, social engineering. What specific technique?",
                "what can you do": "I provide pentesting guidance, tool usage, vulnerability explanations, and security best practices. Try asking about specific tools or attacks.",
                "thank you": "Acknowledgement received. Continue security operations.",
                "bye": "Session terminated. Remember: always test ethically and with proper authorization."
            }
        };
    }

    async sendMessage(message) {
        if (this.isThinking) return;
        
        this.isThinking = true;
        
        // Add user message to conversation
        this.conversation.push({
            type: 'user',
            content: message,
            timestamp: new Date().toISOString()
        });

        // Generate AI response
        const response = await this.generateResponse(message);
        
        this.conversation.push({
            type: 'ai',
            content: response,
            timestamp: new Date().toISOString()
        });

        this.isThinking = false;
        return response;
    }

    async generateResponse(message) {
        const lowerMessage = message.toLowerCase().trim();
        
        // Simulate AI thinking delay
        await this.simulateThinking();
        
        // Check for greetings
        if (this.knowledgeBase.responses[lowerMessage]) {
            if (this.knowledgeBase.responses[lowerMessage] === 'greetings') {
                return this.knowledgeBase.greetings[
                    Math.floor(Math.random() * this.knowledgeBase.greetings.length)
                ];
            }
            return this.knowledgeBase.responses[lowerMessage];
        }

        // Check for pentesting topics
        for (const [topic, response] of Object.entries(this.knowledgeBase.pentesting)) {
            if (lowerMessage.includes(topic)) {
                return response;
            }
        }

        // Default response for unknown queries
        const defaultResponses = [
            "Query analyzed. Please rephrase or ask about specific pentesting techniques.",
            "My expertise is cybersecurity penetration testing. Ask about tools or methodologies.",
            "I specialize in offensive security. Try: 'How do I use nmap?' or 'Explain SQL injection'",
            "Security protocols require specific queries. Reference tools or attack vectors.",
            "Clarify your pentesting inquiry. I can assist with reconnaissance, scanning, or exploitation."
        ];
        
        return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }

    async simulateThinking() {
        // Random delay between 1-3 seconds
        const delay = 1000 + Math.random() * 2000;
        return new Promise(resolve => setTimeout(resolve, delay));
    }

    getConversation() {
        return this.conversation;
    }

    clearConversation() {
        this.conversation = [];
    }

    // Advanced pentesting guidance
    getPentestingMethodology() {
        return {
            reconnaissance: "Passive: OSINT, DNS enumeration. Active: Port scanning, network mapping.",
            scanning: "Vulnerability assessment, service enumeration, network topology mapping.",
            exploitation: "Gaining access using identified vulnerabilities, privilege escalation.",
            postExploitation: "Maintaining access, lateral movement, data exfiltration.",
            reporting: "Documenting findings, risk assessment, remediation recommendations."
        };
    }

    getToolRecommendation(scenario) {
        const tools = {
            "web": ["Burp Suite", "OWASP ZAP", "Nikto", "SQLmap", "XSSer"],
            "network": ["Nmap", "Masscan", "Nessus", "OpenVAS", "Wireshark"],
            "wireless": ["Aircrack-ng", "Kismet", "Wifite", "Reaver", "Bully"],
            "social": ["SEToolkit", "Gophish", "King Phisher", "Evilginx2"],
            "password": ["John the Ripper", "Hashcat", "Hydra", "Medusa"]
        };

        for (const [type, toolList] of Object.entries(tools)) {
            if (scenario.toLowerCase().includes(type)) {
                return `For ${type} testing: ${toolList.join(', ')}`;
            }
        }

        return "Specify testing scenario: web, network, wireless, social, or password.";
    }
}

// Initialize global AI instance
const pentestAI = new PentestAI();
